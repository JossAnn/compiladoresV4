<!DOCTYPE html>
<html>

<head>
    <title class="entrada">Consultas SQL</title>
    <!-- Estilos de Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
</head>

<style>
    body {
        background: #161b22;
        background: linear-gradient(90deg, rgba(19, 25, 34, 0.793) 0%, rgba(11, 4, 34, 0.828) 50%, rgba(24, 32, 42, 0.799) 100%);
        color: #fff;
        font-family: Arial, sans-serif;
    }

    #tokens,
    #results {
        background-color: #e5e5f7;
        padding: 20px;
        border-radius: 10px;
        margin-top: 20px;
        text-align: left;
        color: #000;
    }

    .entrada {
        margin-top: 20px;
    }
</style>

<body>
    <div class="container">
        <h1 class="mt-5">Consulta SQL</h1>

        <div class="accordion color2" id="accordionExample">
            <div class="accordion-item color2">
                <h2 class="accordion-header" id="headingFour">
                    <button class="accordion-button color1 collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
                        Crear Nueva Tabla
                    </button>
                </h2>
                <div id="collapseFour" class="accordion-collapse collapse" aria-labelledby="headingFour"
                    data-bs-parent="#accordionExample">
                    <div class="accordion-body">
                        <div class="input-group mb-3">
                            <input type="text" name="sql_statement[]" class="form-control"
                                placeholder="Ejemplo: CREATE TABLE users (id INT, name VARCHAR(50), age INT);"
                                aria-label="Recipient's username" aria-describedby="button-addon2"
                                value="CREATE TABLE users (id INT, name VARCHAR(50), age INT);">
                            <button class="btn btn-outline-secondary" type="button" id="button-addon2"
                                onclick="executeQuery(this)">Enviar</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingOne">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                        Obtener Datos
                    </button>
                </h2>
                <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne"
                    data-bs-parent="#accordionExample">
                    <div class="accordion-body">
                        <div class="input-group mb-3">
                            <input type="text" name="sql_statement[]" class="form-control" placeholder="Ejemplo: SELECT name, age FROM users;
                                " aria-label="Recipient's username" aria-describedby="button-addon2"
                                value="SELECT name, age FROM users;   ">
                            <button class="btn btn-outline-secondary" type="button" id="button-addon2"
                                onclick="executeQuery(this)">Enviar</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingTwo">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                        Crear Usuario Nuevo
                    </button>
                </h2>
                <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo"
                    data-bs-parent="#accordionExample">
                    <div class="accordion-body">
                        <div class="input-group mb-3">
                            <input type="text" name="sql_statement[]" class="form-control"
                                placeholder="Ejemplo: INSERT INTO users (name, age) VALUES ('John Doe', 30);"
                                aria-label="Recipient's username" aria-describedby="button-addon2"
                                value="INSERT INTO users (name, age) VALUES ('John Doe', 30); ">
                            <button class="btn btn-outline-secondary" type="button" id="button-addon2"
                                onclick="executeQuery(this)">Enviar</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingThree5">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseThree5" aria-expanded="false" aria-controls="collapseThree5">
                        Actualizar Usuario
                    </button>
                </h2>
                <div id="collapseThree5" class="accordion-collapse collapse" aria-labelledby="headingThree5"
                    data-bs-parent="#accordionExample">
                    <div class="accordion-body">
                        <div class="input-group mb-3">
                            <input type="text" name="sql_statement[]" class="form-control"
                                placeholder="Ejemplo: UPDATE users SET age = 25 WHERE name = 'John Doe';"
                                aria-label="Recipient's username" aria-describedby="button-addon2"
                                value="UPDATE users SET age = 25 WHERE name = 'John Doe';">
                            <button class="btn btn-outline-secondary" type="button" id="button-addon2"
                                onclick="executeQuery(this)">Enviar</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingThree4">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseThree4" aria-expanded="false" aria-controls="collapseThree4">
                        Eliminar Usuario
                    </button>
                </h2>
                <div id="collapseThree4" class="accordion-collapse collapse" aria-labelledby="headingThree4"
                    data-bs-parent="#accordionExample">
                    <div class="accordion-body">
                        <div class="input-group mb-3">
                            <input type="text" name="sql_statement[]" class="form-control"
                                placeholder="Ejemplo: DELETE FROM users WHERE age < 18;"
                                aria-label="Recipient's username" aria-describedby="button-addon2"
                                value="DELETE FROM users WHERE age < 18;">
                            <button class="btn btn-outline-secondary" type="button" id="button-addon2"
                                onclick="executeQuery(this)">Enviar</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingThree3">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseThree3" aria-expanded="false" aria-controls="collapseThree3">
                        Borrar Tabla
                    </button>
                </h2>

                <div id="collapseThree3" class="accordion-collapse collapse" aria-labelledby="headingThree3"
                    data-bs-parent="#accordionExample">
                    <div class="accordion-body">
                        <div class="input-group mb-3">
                            <input type="text" name="sql_statement[]" class="form-control"
                                placeholder="Ejemplo: DROP TABLE users;" aria-label="Recipient's username"
                                aria-describedby="button-addon2" value="DROP TABLE users;">
                            <button class="btn btn-outline-secondary" type="button" id="button-addon2"
                                onclick="executeQuery(this)">Enviar</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row justify-content-center mt-5">
            <div class="col-md-8">
                <h2>Tokens identificados:</h2>
                <div id="tokens">
                    <!-- Aquí se mostrarán los tokens identificados -->
                </div>
            </div>
        </div>

        <div class="row justify-content-center mt-5">
            <div class="col-md-8">
                <h2>Resultados:</h2>
                <div id="results">
                    <!-- Aquí se mostrarán los resultados de las consultas -->
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts de Bootstrap y lógica de AJAX -->

    <script>
        // Función para realizar la solicitud AJAX y mostrar los resultados
        function executeQuery(button) {
            const sqlStatement = button.previousElementSibling.value;
            const xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function () {
                if (xhr.readyState === XMLHttpRequest.DONE) {
                    if (xhr.status === 200) {
                        const response = JSON.parse(xhr.responseText);
                        displayTokens(response.tokens_info); // Agregar esta línea para mostrar los tokens
                        displayResults(response.resultados);
                    } else {
                        alert("Error al ejecutar la consulta.");
                    }
                }
            };
            xhr.open("POST", "/");
            xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
            xhr.send("sql_statement=" + encodeURIComponent(sqlStatement));
        }

        // Función para mostrar los tokens identificados en la página
        function displayTokens(tokens_info) {
            const tokensDiv = document.getElementById("tokens");
            tokensDiv.innerHTML = "<pre>" + JSON.stringify(tokens_info, null, 2) + "</pre>";
        }

        // Función para mostrar los resultados de la consulta en la página
        function displayResults(resultados) {
            const resultsDiv = document.getElementById("results");
            resultsDiv.innerHTML = "<pre>" + JSON.stringify(resultados, null, 2) + "</pre>";
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous">
        </script>

</body>

</html>